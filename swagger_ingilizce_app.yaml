openapi: 3.0.0
info:
  title: İngilizce Öğrenme Uygulaması API (Sosyal & İstatistikli)
  description: |
    Mobil uygulama için geliştirilmiş, öğrenme modülleri, detaylı istatistikler ve sosyal özellikler içeren REST API.
  version: 1.0.0

# --- DÜZELTME: Sunucu adresini kök yaptık (sonda /api yok) ---
servers:
  - url: http://127.0.0.1:8000
    description: Docker/Yerel Geliştirme Ortamı

# --- JWT Ayarları ---
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

security:
  - bearerAuth: []

tags:
  - name: Kimlik Doğrulama
  - name: Öğrenme Modülleri
  - name: İstatistikler ve Sosyal
  - name: Analiz ve Değerlendirme

# --- TÜM YOLLAR (Başına /api eklendi) ---
paths:
  # --- Kimlik Doğrulama ---
  /api/auth/login:
    post:
      tags: [Kimlik Doğrulama]
      summary: Kullanıcı Girişi
      security: []  # Giriş yaparken token gerekmez
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username: { type: string, example: user1 }
                password: { type: string, example: pass1 }
      responses:
        '200': { description: Giriş başarılı, istatistikler ve son giriş tarihi döndürüldü. }
  
  /api/auth/register:
    post:
      tags: [Kimlik Doğrulama]
      summary: Yeni Kullanıcı Kaydı
      security: []  # Kayıt olurken token gerekmez
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username: { type: string, example: yeni_kullanici }
                password: { type: string, example: sifre123 }
      responses:
        '201': { description: Kayıt başarılı. }

  # --- Öğrenme Modülleri ---
  /api/words:
    get:
      tags: [Öğrenme Modülleri]
      summary: Kelime Listesini Getir
      responses:
        '200': { description: Kelime listesi döndürüldü. }

  /api/words/repeat:
    post:
      tags: [Öğrenme Modülleri]
      summary: Kelime İlerlemesini Kaydet ve İstatistikleri Güncelle
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                word_id: { type: integer, example: 3 }
                username: { type: string, example: user1 }
      responses:
        '200': { description: İlerleme kaydedildi, güncel istatistikler döndürüldü. }

  /api/grammar/quiz:
    post:
      tags: [Öğrenme Modülleri]
      summary: Dilbilgisi Quizini Gönder ve İstatistikleri Güncelle
      responses:
        '200': { description: Quiz sonucu ve güncel istatistikler döndürüldü. }

  /api/tests/submit:
    post:
      tags: [Öğrenme Modülleri]
      summary: Test Cevaplarını Gönder, Değerlendir ve İstatistikleri Güncelle
      responses:
        '200': { description: Değerlendirme sonucu ve güncel istatistikler döndürüldü. }

  # --- İstatistikler ve Sosyal ---
  /api/stats/{username}:
    get:
      tags: [İstatistikler ve Sosyal]
      summary: Kullanıcı İstatistiklerini Getir
      parameters:
        - in: path
          name: username
          schema: { type: string }
          required: true
      responses:
        '200': { description: Detaylı öğrenme istatistikleri, seviye ve skor döndürüldü. }
        
  /api/profile/{username}:
    get:
      tags: [İstatistikler ve Sosyal]
      summary: Kullanıcı Profilini Getir
      responses:
        '200': { description: Kullanıcının temel profil ve istatistik bilgileri döndürüldü. }

  /api/scoreboard:
    get:
      tags: [İstatistikler ve Sosyal]
      summary: Global Skor Tahtasını Getir
      responses:
        '200': { description: Tüm kullanıcıların skor ve seviyeye göre sıralı listesi döndürüldü. }

  /api/social/add_friend:
    post:
      tags: [İstatistikler ve Sosyal]
      summary: Arkadaş Ekleme
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                current_user: { type: string, example: user2 }
                friend_to_add: { type: string, example: user3 }
      responses:
        '200': { description: Arkadaş ekleme işlemi başarılı. }

  /api/social/friends:
    get:
      tags: [İstatistikler ve Sosyal]
      summary: Arkadaş Listesini Getir
      parameters:
        - in: query
          name: current_user
          schema: { type: string, default: user1 }
      responses:
        '200': { description: Arkadaşların skor ve seviye bilgileriyle listesi döndürüldü. }

  # --- Analiz ve Değerlendirme ---
  /api/speech/analyze:
    post:
      tags: [Analiz ve Değerlendirme]
      summary: Telaffuz Analizi (Mock)
      responses:
        '200': { description: Analiz sonucu başarılı. }

  /api/writing/check:
    post:
      tags: [Analiz ve Değerlendirme]
      summary: Yazma ve Dilbilgisi Kontrolü (Mock)
      responses:
        '200': { description: Kontrol ve not başarılı. }